const roll=document.querySelector(".roll"),dice=document.querySelectorAll(".die"),holdRow=document.querySelector(".hold-buttons"),holds=document.querySelectorAll(".hold"),hold1=document.querySelector(".hold--1"),hold2=document.querySelector(".hold--2"),hold3=document.querySelector(".hold--3"),hold4=document.querySelector(".hold--4"),hold5=document.querySelector(".hold--5"),helds=document.querySelectorAll(".held"),held1=document.querySelector(".held--1"),held2=document.querySelector(".held--2"),held3=document.querySelector(".held--3"),held4=document.querySelector(".held--4"),held5=document.querySelector(".held--5"),rollNumber=document.querySelector("#roll-no"),turnNumber=document.querySelector("#turn-no"),chooseMessage=document.querySelector("#choose-message"),currentScore=document.querySelector("#current-score"),chooseScoreButtons=document.querySelectorAll(".choose-score"),highScoreText=document.querySelector("#high-score"),shareAndCopyButton=document.querySelector("#share"),shareCopy=document.querySelector("#share-copy"),cookieLength=2,cookieLengthYear=365;let scoreCard={ones:null,twos:null,threes:null,fours:null,fives:null,sixes:null,threeOfAKind:null,fourOfAKind:null,fullHouse:null,smallStraight:null,largeStraight:null,chance:null,yahtzee:null,yahtzeeBonus:null},possibleScores={ones:0,twos:0,threes:0,fours:0,fives:0,sixes:0,threeOfAKind:0,fourOfAKind:0,fullHouse:0,smallStraight:0,largeStraight:0,chance:0,yahtzee:0},scorePicked={ones:"false",twos:"false",threes:"false",fours:"false",fives:"false",sixes:"false",threeOfAKind:"false",fourOfAKind:"false",fullHouse:"false",smallStraight:"false",largeStraight:"false",chance:"false",yahtzee:"false",yahtzeeBonus:"false"},results=[],diceHeld=["false","false","false","false","false"],turnNo=1,rollNo=0,currScore=0,topScore=0,topBonus=!1,yahtzeeBonus=0,highScore=0,bonusMessage="bonus!",newHighMessage="new!",textToCopy="";window.addEventListener("DOMContentLoaded",e=>{resetScoreboard()});const rollDice=()=>{document.querySelector(".dice").classList.remove("first-roll"),results.length&&helds.forEach((e,o)=>{e.classList.contains("yes")||(results[o]=0)}),holdRow.classList="hold-buttons disabled",holds.forEach(e=>{e.querySelector(".hold-button").disabled=!0}),roll.disabled=!0,2!=++rollNo&&3!=rollNo||(rollNumber.textContent=rollNo,document.querySelector(".roll-no").classList.remove("hidden"),document.querySelector(".next-turn").classList.add("hidden")),3==rollNo?(chooseMessage.style.display="block",roll.style.display="none"):chooseMessage.style.display="none",4==rollNo&&(helds.forEach((e,o)=>{e.classList.remove("yes"),diceHeld[o]="false",setCookie("held"+(o+1),diceHeld[o],cookieLength)}),rollNo=1,rollNumber.textContent=rollNo,document.querySelector(".roll-no").classList.remove("hidden"),document.querySelector(".next-turn").classList.add("hidden"),turnNo++,turnNumber.textContent=turnNo);let e=100,t=8,l=10,s=12,r=14,c=16;held1.classList.contains("yes")||!function o(){chooseScoreButtons.forEach(e=>{e.style.display="none"});setTimeout(()=>{let e=Math.floor(6*Math.random())+1;document.querySelector(".die--one").classList="die die--one r"+e,0<--t?o():results[0]=e,0!=t||5!=results.length||results.includes(0)||(showPossibleScores(results),roll.disabled=!1)},e)}(),held2.classList.contains("yes")||function o(){chooseScoreButtons.forEach(e=>{e.style.display="none"});setTimeout(()=>{let e=Math.floor(6*Math.random())+1;document.querySelector(".die--two").classList="die die--two r"+e,0<--l?o():results[1]=e,0!=l||5!=results.length||results.includes(0)||(showPossibleScores(results),roll.disabled=!1)},e)}(),held3.classList.contains("yes")||function o(){chooseScoreButtons.forEach(e=>{e.style.display="none"});setTimeout(()=>{let e=Math.floor(6*Math.random())+1;document.querySelector(".die--three").classList="die die--three r"+e,0<--s?o():results[2]=e,0!=s||5!=results.length||results.includes(0)||(showPossibleScores(results),roll.disabled=!1)},e)}(),held4.classList.contains("yes")||function o(){chooseScoreButtons.forEach(e=>{e.style.display="none"});setTimeout(()=>{let e=Math.floor(6*Math.random())+1;document.querySelector(".die--four").classList="die die--four r"+e,0<--r?o():results[3]=e,0!=r||5!=results.length||results.includes(0)||(showPossibleScores(results),roll.disabled=!1)},e)}(),held5.classList.contains("yes")||function o(){chooseScoreButtons.forEach(e=>{e.style.display="none"});setTimeout(()=>{let e=Math.floor(6*Math.random())+1;document.querySelector(".die--five").classList="die die--five r"+e,0<--c?o():results[4]=e,0!=c||5!=results.length||results.includes(0)||(showPossibleScores(results),roll.disabled=!1)},e)}()},showPossibleScores=(roll.addEventListener("click",rollDice),o=>{chooseScoreButtons.forEach(e=>{e.style.display="block"}),rollNo<3&&(holdRow.classList="hold-buttons enabled",holds.forEach(e=>{e.querySelector(".hold-button").disabled=!1})),possibleScores.ones=o.filter(e=>1==e).reduce((e,o)=>e+o,0),possibleScores.twos=o.filter(e=>2==e).reduce((e,o)=>e+o,0),possibleScores.threes=o.filter(e=>3==e).reduce((e,o)=>e+o,0),possibleScores.fours=o.filter(e=>4==e).reduce((e,o)=>e+o,0),possibleScores.fives=o.filter(e=>5==e).reduce((e,o)=>e+o,0),possibleScores.sixes=o.filter(e=>6==e).reduce((e,o)=>e+o,0);var e,t,l=t=>t.filter((e,o)=>t.indexOf(e)!==o),s=l(o),l=l(s),r=0<l.length,r=(possibleScores.threeOfAKind=r?o.reduce((e,o)=>e+o,0):0,2==l.length||3==l.length),r=(possibleScores.fourOfAKind=r?o.reduce((e,o)=>e+o,0):0,3==s.length&&1==l.length),s=(possibleScores.fullHouse=r?25:0,[1,2,3,4].every(e=>o.includes(e))||[2,3,4,5].every(e=>o.includes(e))||[3,4,5,6].every(e=>o.includes(e))),l=(possibleScores.smallStraight=s?30:0,[1,2,3,4,5].every(e=>o.includes(e))||[2,3,4,5,6].every(e=>o.includes(e))),r=(possibleScores.largeStraight=l?40:0,possibleScores.chance=o.reduce((e,o)=>e+o,0),o.every((e,o,t)=>e===t[0]));possibleScores.yahtzee=r?50:0,r&&("0"==scoreCard.yahtzee?(l=(s=["😒","🤦‍♀️","😢","😣","🙄","😭","😕","😟","💔"])[Math.floor(Math.random()*s.length)],document.querySelector("#final-score-yahtzee").innerHTML+=`<span class="emoji"> ${l}</span>`):document.querySelector(".yahtzee-logo-header").classList.add("active")),r&&50==scoreCard.yahtzee&&calcBonusYahtzeeScore();for([e,t]of Object.entries(possibleScores))document.querySelector("#score-"+e).textContent=t;updateCookies()}),setCookie=(chooseScoreButtons.forEach(o=>{o.addEventListener("click",()=>{document.querySelector(".yahtzee-logo-header").classList.remove("active"),document.querySelector("#joker-text").style.display="none",holdRow.classList="hold-buttons disabled",holds.forEach(e=>{e.querySelector(".hold-button").disabled=!0}),chooseMessage.style.display="none",chooseScoreButtons.forEach(e=>{e.style.display="none"}),document.querySelector(".roll-no").classList.add("hidden"),document.querySelector(".next-turn").classList.remove("hidden");var e=o.getAttribute("id").split("-").pop();scoreCard[e]=possibleScores[e].toString(),scorePicked[e]="true",o.classList.add("already-chosen"),o.disabled=!0,document.querySelector("#final-score-"+e).textContent=scoreCard[e],updateTopScore(),updateCurrentScore(),rollNo=3,updateCookies(),results=[],turnNo<13?roll.style.display="block":(roll.style.display="none",endGame())})}),holds.forEach(t=>{t.addEventListener("click",()=>{var e,o;holdRow.classList.contains("enabled")&&(e=t.dataset.holdDie,document.querySelector(".held--"+e).classList.toggle("yes"),document.querySelector(".held--"+e).classList.contains("yes")?diceHeld[e-1]="true":diceHeld[e-1]="false",setCookie("held"+e,diceHeld[e-1],cookieLength),"true"==diceHeld[0]&&(o=diceHeld).every(e=>e===o[0])?(console.log("all dice are held"),chooseMessage.style.display="block",roll.style.display="none"):(console.log("at least 1 die isnt held"),chooseMessage.style.display="none",roll.style.display="block"))})}),(e,o,t)=>{let l="";var s;t&&((s=new Date).setTime(s.getTime()+24*t*60*60*1e3),l="; expires="+s.toUTCString()),document.cookie=e+"="+(o||"")+l+"; path=/"}),updateCookies=()=>{setCookie("turnNumber",turnNo,cookieLength),setCookie("rollNumber",rollNo,cookieLength),setCookie("currentRollResults",results,cookieLength),console.log("current roll just set to cookies:"),console.log(getCookie("currentRollResults"));for(var[e,o]of Object.entries(scorePicked))setCookie("picked"+e,""+o,cookieLength);for(var[t,l]of Object.entries(scoreCard))"true"==scorePicked[t]&&(setCookie(""+t,""+l,cookieLength),console.log(`cookie ${t} updated and its value is `+l))},resetScoreboard=()=>{null!==getCookie("highScore")?(highScore=getCookie("highScore"),highScoreText.textContent=highScore,console.log("highscore from cookie: "+highScore)):(highScoreText.textContent=highScore,setCookie("highScore","0",cookieLengthYear),console.log("highscore NOT from cookie: "+highScore)),null!==getCookie("turnNumber")&&(turnNo=getCookie("turnNumber")),turnNumber.textContent=turnNo,null!==getCookie("rollNumber")?(rollNo=getCookie("rollNumber"),rollNumber.textContent=rollNo,document.querySelector(".roll-no").classList.remove("hidden"),document.querySelector(".next-turn").classList.add("hidden")):rollNumber.textContent=1;for(let e=1;e<=diceHeld.length;e++)getCookie("held"+e)&&(diceHeld[e-1]=getCookie("held"+e),"true"==getCookie("held"+e)?document.querySelector(".held--"+e).classList.add("yes"):document.querySelector(".held--"+e).classList.remove("yes"));let e=0;for(const o in scorePicked)"true"==getCookie("picked"+o)&&(scoreCard[o]=getCookie(o),scorePicked[o]="true",document.querySelector("#final-score-"+o).textContent=scoreCard[o],document.querySelector("#score-"+o).classList.add("already-chosen"),e++);if(null!==getCookie("yahtzeeBonus")){yahtzeeBonus=getCookie("yahtzeeBonus")/100;for(let e=0;e<yahtzeeBonus;e++)document.querySelector("#yahtzee-bonus").textContent+="✓",document.querySelector("#yz-dialog-yahtzees").textContent+="✅"}null!==getCookie("currentRollResults")?(document.querySelector(".dice").classList.remove("first-roll"),resultsStrings=getCookie("currentRollResults").split(","),results=resultsStrings.map(Number),console.log("currentRollResults"),console.log(results),dice.forEach(e=>{e.classList.remove("r1","r2","r3","r4","r5","r6")}),document.querySelector(".die--one").classList.add("r"+results[0]),document.querySelector(".die--two").classList.add("r"+results[1]),document.querySelector(".die--three").classList.add("r"+results[2]),document.querySelector(".die--four").classList.add("r"+results[3]),document.querySelector(".die--five").classList.add("r"+results[4]),0<rollNo&&turnNo!=e&&(showPossibleScores(results),3==rollNo)&&(chooseMessage.style.display="block",roll.style.display="none"),turnNo==e&&(chooseMessage.style.display="none",roll.style.display="block",document.querySelector(".roll-no").classList.add("hidden"),document.querySelector(".next-turn").classList.remove("hidden"))):(document.querySelector(".die--one").classList.add("r1"),document.querySelector(".die--two").classList.add("r2"),document.querySelector(".die--three").classList.add("r3"),document.querySelector(".die--four").classList.add("r4"),document.querySelector(".die--five").classList.add("r5")),updateTopScore(),updateCurrentScore(),13==turnNo&&13==e&&endGame()},updateTopScore=()=>(63<=(topScore=Number(scoreCard.ones)+Number(scoreCard.twos)+Number(scoreCard.threes)+Number(scoreCard.fours)+Number(scoreCard.fives)+Number(scoreCard.sixes))&&(document.querySelector("#top-bonus").textContent=bonusMessage,document.querySelector("#top-bonus-final").textContent=bonusMessage,topBonus=!0,topScore+=35),document.querySelector("#current-top").textContent=topScore),updateCurrentScore=()=>{currScore=Object.values(scoreCard).reduce((e,o)=>Number(e)+Number(o),0),topBonus&&(currScore+=35),currentScore.textContent=currScore},calcBonusYahtzeeScore=()=>{yahtzeeBonus++,document.querySelector("#yahtzee-bonus").textContent+="✓",document.querySelector("#yz-dialog-yahtzees").textContent+="✅",scoreCard.yahtzeeBonus=100*yahtzeeBonus,scorePicked.yahtzeeBonus="true",updateCurrentScore(),updateCookies(),document.querySelector("#joker-text").style.display="block",roll.style.display="none",chooseMessage.style.display="block",holdRow.classList="hold-buttons disabled",holds.forEach(e=>{e.querySelector(".hold-button").disabled=!0}),possibleScores.fullHouse=25,possibleScores.smallStraight=30,possibleScores.largeStraight=40,document.querySelector("#score-fullHouse").textContent=possibleScores.fullHouse,document.querySelector("#score-smallStraight").textContent=possibleScores.smallStraight,document.querySelector("#score-largeStraight").textContent=possibleScores.largeStraight},endGame=()=>{roll.style.display="none",rollNumber.style.display="none",document.querySelector(".next-turn").style.display="none",document.querySelector("#show-message").style.display="block",document.querySelector(".new-game-2").style.display="block",document.querySelector("#yz-dialog-final-score").textContent=currScore,document.querySelector("#yz-dialog-subtotal-score").textContent=topScore,currScore>highScore&&(highScore=currScore,document.querySelector("#yz-new-high").textContent=newHighMessage,highScoreText.textContent=highScore),document.querySelector("#yz-dialog-high-score").textContent=highScore,console.log("highScore was saved in cookies as "+highScore),setCookie("highScore",highScore,cookieLengthYear),"50"==scoreCard.yahtzee?document.querySelector("#yz-dialog-yahtzees").textContent+="✅":document.querySelector("#yz-dialog-yahtzees").textContent="0",createShareData(),openDialog("yz-scores")},getCookie=e=>{for(var o=e+"=",t=document.cookie.split(";"),l=0;l<t.length;l++){for(var s=t[l];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(o))return s.substring(o.length,s.length)}return null},eraseCookie=e=>{document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"},newGame=()=>{for(var e=document.cookie.split(";"),o=0;o<e.length;o++){var t=e[o].split("=")[0];t.includes("highScore")||eraseCookie(t)}location.reload(),document.querySelector(".dice").classList.add("first-roll")},createShareData=()=>{textToCopy=`🎲 ${currScore}${document.querySelector("#yz-new-high").textContent==newHighMessage?" (new high score!)":""}
Yahtzees: ${document.querySelector("#yz-dialog-yahtzees").textContent}
Top bonus: ${topBonus?"✅":"❌"}
Play @ kylephx.com/yahtzee`;var e=document.createElement("textarea");e.setAttribute("id","share-text"),e.style.display="none",document.body.appendChild(e),document.getElementById("share-text").value=textToCopy},testYahtzee=(shareAndCopyButton.addEventListener("click",async()=>{var e={title:"Yahtzee",text:textToCopy};try{await navigator.clipboard.writeText(textToCopy),console.log("Content copied to clipboard"),shareCopy.textContent="Copied to clipboard"}catch(e){console.error("Failed to copy: ",e)}try{await navigator.share(e)}catch(e){console.error("Error: "+e)}}),()=>{rollDice(),setTimeout(()=>{fakeResults=[5,5,5,5,5],document.querySelector(".die--one").textContent=5,document.querySelector(".die--two").textContent=5,document.querySelector(".die--three").textContent=5,document.querySelector(".die--four").textContent=5,document.querySelector(".die--five").textContent=5,showPossibleScores(fakeResults),50==scoreCard.yahtzeeBonus&&(calcBonusYahtzeeScore(),updateCurrentScore(),updateCookies())},3e3)});function Dialog(e){this.dialogEl=document.querySelector("#"+e),this.focusedElBeforeOpen;e=this.dialogEl.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]');this.focusableEls=Array.prototype.slice.call(e),this.firstFocusableEl=this.focusableEls[0],this.lastFocusableEl=this.focusableEls[this.focusableEls.length-1],this.close()}Dialog.prototype.open=function(e){var o,t=this,l=document.querySelectorAll('.yz-dialog[aria-hidden="false"]');this.dialogEl=e?document.querySelector("#"+e):this.dialogEl,this.focusedElBeforeOpen=document.activeElement,this.dialogEl.hasAttribute("data-yz-dialog-top")&&(e=this.dialogEl.getAttribute("data-yz-dialog-top"),this.dialogEl.style.top=e+"px"),document.body.classList.add("yz-dialog-fixed-page"),0==document.getElementsByClassName("yz-dialog-overlay").length?((o=document.createElement("div")).classList.add("yz-dialog-overlay"),document.body.appendChild(o)):(o=document.querySelector(".yz-dialog-overlay")).style.display="",this.dialogEl.classList.contains("yz-dialog--mobile-full")?o.classList.add("yz-dialog-overlay--mobile-full"):o.classList.remove("yz-dialog-overlay--mobile-full");for(var s=0;s<l.length;s++)l[s].setAttribute("aria-hidden",!0);o.appendChild(this.dialogEl),this.dialogEl.setAttribute("aria-hidden",!1),o.setAttribute("aria-hidden",!1),o.scrollTop=0,this.dialogEl.addEventListener("keydown",function(e){t._handleKeyDown(e)}),o.addEventListener("click",function(e){o===e.target&&t.close()}),this.firstFocusableEl&&this.firstFocusableEl.focus()},Dialog.prototype.close=function(e){var o=document.getElementsByClassName("yz-dialog-overlay")[0];if(document.body.classList.remove("yz-dialog-fixed-page"),e){if("false"!==document.querySelector("#"+e).getAttribute("aria-hidden"))return;document.querySelector("#"+e).setAttribute("aria-hidden",!0)}else this.dialogEl.setAttribute("aria-hidden",!0);o&&o.setAttribute("aria-hidden",!0),this.focusedElBeforeOpen&&this.focusedElBeforeOpen.focus()},Dialog.prototype._handleKeyDown=function(e){var o=this;switch(e.keyCode){case 9:1===o.focusableEls.length?e.preventDefault():e.shiftKey?document.activeElement===o.firstFocusableEl&&(e.preventDefault(),o.lastFocusableEl.focus()):document.activeElement===o.lastFocusableEl&&(e.preventDefault(),o.firstFocusableEl.focus());break;case 27:o.close()}},Dialog.prototype.addEventListeners=function(e,o){var t=this,e=document.querySelector(`[data-dialog-trigger="${e}"]`),l=document.querySelectorAll(""+o);e.addEventListener("click",function(e){t.open()});for(var s=0;s<l.length;s++)l[s].addEventListener("click",function(){t.close()})};var openDialog=function(e){Dialog.prototype.open(e)},closeDialog=function(e){Dialog.prototype.close(e)},dialogs=document.getElementsByClassName("yz-dialog");window.addEventListener("DOMContentLoaded",()=>{for(var e=0;e<dialogs.length;e++)new Dialog(dialogs[e].id).addEventListeners(dialogs[e].id,".yz-dialog-close")});