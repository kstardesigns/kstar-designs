const express=require("express"),fetch=require("node-fetch"),path=require("path"),app=express(),clientId="cwy5ta7roxwn4rvpsyiou8bhz2ggbg",clientSecret="ewmh7s6p58wok1zrn3p23yfbreb2wc";let accessToken="";async function getAccessToken(){try{const e=await fetch("https://id.twitch.tv/oauth2/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:clientId,client_secret:clientSecret,grant_type:"client_credentials"})}),t=await e.json();accessToken=t.access_token,console.log("Access token obtained:",accessToken)}catch(e){console.error("Error obtaining access token:",e)}}async function fetchData(e){try{console.log("Sending request with query:",e),console.log("access:"+accessToken);const t=await fetch("https://api.igdb.com/v4/games",{method:"POST",headers:{"Client-ID":clientId,Authorization:`Bearer ${accessToken}`,Accept:"application/json"},body:e}),c=await t.json();return console.log("Raw response data:",c),c}catch(e){throw console.error("Error fetching data from IGDB:",e),e}}app.use(express.static(path.join(__dirname,"public"))),app.get("/games",(async(e,t)=>{accessToken||await getAccessToken();const c=e.query.search;try{const e=`search "${c}"; where rating > 1; fields *; limit 10;`,a=await fetchData(e);t.json(a)}catch(e){t.status(500).json({error:"Failed to fetch data from IGDB"})}})),app.get("/game",(async(e,t)=>{accessToken||await getAccessToken();const c=e.query.id;try{const e=`where id = ${c}; fields *;`,a=await fetchData(e);t.json(a)}catch(e){t.status(500).json({error:"Failed to fetch data from IGDB"})}})),app.get("*",((e,t)=>{t.sendFile(path.join(__dirname,"public","index.html"))})),app.listen(3e3,(()=>{console.log("Server is running on port 3000")}));